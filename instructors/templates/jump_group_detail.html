<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Прыжковая группа {{ jump_group.id }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1, h2 {
            color: #333;
        }

        .passed {
            color: green;
            font-weight: bold;
        }

        .failed {
            color: red;
            font-weight: bold;
        }

        .not-assigned {
            color: orange;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Прыжковая группа</h1>

<p><strong>Инструктор по
    воздуху:</strong> {{ jump_group.instructor_air.first_name }} {{ jump_group.instructor_air.last_name }}</p>
<p><strong>Инструктор на
    земле:</strong> {{ jump_group.instructor_ground.first_name }} {{ jump_group.instructor_ground.last_name }}</p>
<p><strong>Статус:</strong> {{ jump_group.get_status_display }}</p>
<p><strong>Дата начала:</strong> {{ jump_group.start_date_time|date:"d.m.Y H:i" }}</p>
{% if jump_group.end_date_time %}
    <p><strong>Дата окончания:</strong> {{ jump_group.end_date_time|date:"d.m.Y H:i" }}</p>
{% endif %}

<!-- Кнопки для изменения статуса группы -->
{% if jump_group.status == 'created' %}
    <a href="{% url 'start_pre_flight_preparation' instructor_id=instructor.instructor_id jump_group_id=jump_group.id %}">
        <button>Начать предполетную подготовку</button>
    </a>
{% elif jump_group.status == 'Pre-Flight Preparation' %}
    <a href="{% url 'complete_pre_flight_preparation' instructor_id=instructor.instructor_id jump_group_id=jump_group.id %}">
        <button>Завершить предполетную подготовку</button>
    </a>
{% elif jump_group.status == 'Jump In Progress' %}
    <!-- Если группа в процессе, показываем кнопку для выставления оценки -->
    <p>Для каждого парашютиста необходимо выставить оценку за прыжок.</p>
{% endif %}

<h2>Парашютисты в группе</h2>

{% if request_data %}
    <ul>
        {% for item in request_data %}
            <li>
                <strong>
                    {% if jump_group.status == 'Pre-Flight Preparation' %}
                        <a href="{% url 'edit_jump_checkpoint' instructor_id=instructor.instructor_id jump_group_id=jump_group.id parachutist_id=item.request.parachutist.parachutist_id %}">
                            {{ item.request.parachutist.first_name }} {{ item.request.parachutist.last_name }}
                        </a>
                    {% elif jump_group.status == 'Jump In Progress' %}
                        <!-- Для статуса "Jump In Progress" просто выводим имя без ссылки -->
                        {{ item.request.parachutist.first_name }} {{ item.request.parachutist.last_name }}
                    {% else %}
                        {{ item.request.parachutist.first_name }} {{ item.request.parachutist.last_name }}
                    {% endif %}

                </strong>
                <ul>
                    <li>Статус заявки: {{ item.request.get_request_status_display }}</li>
                    <li>Задание:
                        {% if item.task %}
                            {{ item.task }}
                        {% else %}
                            <span class="not-assigned">не назначено</span>
                        {% endif %}
                    </li>

                    <!-- Если группа не в статусе "Jump In Progress", показываем все чекпоинты -->
                    {% if jump_group.status != 'Jump In Progress' %}
                        <li>Теория:
                            <span class="{% if item.request.theory_passed %}passed{% else %}failed{% endif %}">
                                {% if item.request.theory_passed %}✔ Пройдено{% else %}✖ Не пройдено{% endif %}
                            </span>
                        </li>
                        <li>Практика:
                            <span class="{% if item.request.practice_passed %}passed{% else %}failed{% endif %}">
                                {% if item.request.practice_passed %}✔ Пройдено{% else %}✖ Не пройдено{% endif %}
                            </span>
                        </li>
                        <li>Медицинская сертификация:
                            <span class="{% if item.request.medical_certified %}passed{% else %}failed{% endif %}">
                                {% if item.request.medical_certified %}✔ Пройдено{% else %}✖ Не пройдено{% endif %}
                            </span>
                        </li>
                        <li>Проверка снаряжения:
                            <span class="{% if item.request.equipment_checked %}passed{% else %}failed{% endif %}">
                                {% if item.request.equipment_checked %}✔ Пройдено{% else %}✖ Не пройдено{% endif %}
                            </span>
                        </li>
                        <li>Корректное задание:
                            <span class="{% if item.request.correct_assignment %}passed{% else %}failed{% endif %}">
                                {% if item.request.correct_assignment %}✔ Назначено{% else %}✖ Ошибка{% endif %}
                            </span>
                        </li>
                    {% else %}
                        <!-- В случае статуса "Jump In Progress", показываем ссылку -->
                        <li>
                            <a href="{% url 'set_jump_score' instructor_id=instructor.instructor_id jump_group_id=jump_group.id parachutist_id=item.request.parachutist.parachutist_id %}">Выставить
                                оценку за прыжок</a></li>
                    {% endif %}
                </ul>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>Пока нет парашютистов в этой группе.</p>
{% endif %}

<p><a href="{% url 'instructor_schedule' instructor_id=instructor.instructor_id %}">← Назад к расписанию</a></p>

</body>
</html>
